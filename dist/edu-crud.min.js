var eduCrudServices=angular.module("edu-crud.services",[]),eduCrudDirectives=angular.module("edu-crud.directives",[]),eduCrudFilters=angular.module("edu-crud.filters",[]),eduCrudTpl=angular.module("edu-crud.tpl",[]);angular.module("eduCrud",["edu-crud.services","edu-crud.directives","edu-crud.filters","edu-crud.tpl","ngResource","ui.bootstrap","eduForm","eduGrid"]),eduCrudServices.factory("dataFactoryCrud",["$resource",function(a){return function(b,c){var d={getAll:{method:"GET",params:{},withCredentials:!0,isArray:!0},getCount:{method:"GET",url:b+"/count",params:{},withCredentials:!0,isArray:!1},get:{method:"GET",params:{},withCredentials:!0,isArray:!1},insert:{method:"POST",params:{},withCredentials:!0,isArray:!1},update:{method:"PUT",params:{},withCredentials:!0,isArray:!1},remove:{method:"DELETE",params:{},withCredentials:!0,isArray:!1}};if("undefined"!=typeof c&&""!==c)for(keyAction in c)for(keyDefAction in d)keyAction==keyDefAction&&(d[keyDefAction]=c[keyAction]);return a(b,{},d)}}]),eduCrudDirectives.directive("eduCrud",function(){return{restrict:"A",replace:!0,transclude:!1,scope:{ngModel:"=",options:"="},templateUrl:"directives/edu-crud.tpl.html",link:function(a,b){if(!a.hasOwnProperty("options"))throw new Error("options are required!")},controller:["$rootScope","$scope","$log","$q","dataFactoryCrud",function(a,b,c,d,e){function f(a){var c=a[b.options.fieldKey],d={};return d.id=c,b.options.hasOwnProperty("crudListeners")&&"function"==typeof b.options.crudListeners.transformParams&&(d=b.options.crudListeners.transformParams(a)),d}function g(){b.state="new",setTimeout(function(){b.options.formControl.selectTab(0)}),b.showForm=!0;for(e in b.options.formData)b.options.formData[e]="";for(var a=0;a<b.options.formFields.tabs.length;a++)for(var c=0;c<b.options.formFields.tabs[a].fieldSets.length;c++)for(var d=0;d<b.options.formFields.tabs[a].fieldSets[c].fields.length;d++){var e=b.options.formFields.tabs[a].fieldSets[c].fields[d].key,f=b.options.formFields.tabs[a].fieldSets[c].fields[d].type,g=b.options.formFields.tabs[a].fieldSets[c].fields[d]["default"];g?b.options.formData[e]=g:"ckeckbox"==f?b.options.formData[e]="N":b.options.formData[e]="",b.options.formFields.tabs[a].fieldSets[c].fields[d].hasOwnProperty("disabledTmp")&&(b.options.formFields.tabs[a].fieldSets[c].fields[d].disabled=b.options.formFields.tabs[a].fieldSets[c].fields[d].disabledTmp)}if("undefined"!=typeof b.options.fieldFk&&"undefined"!=typeof b.options.valueFk&&(b.options.formData[b.options.fieldFk]=b.options.valueFk),void 0!=typeof b.options.crudListeners&&b.options.crudListeners.hasOwnProperty("onButtonNew")&&"function"==typeof b.options.crudListeners.onButtonNew){var h=b.options.crudListeners.onButtonNew(b.options.formData);setTimeout(function(){b.$apply(function(){b.options.formData=h})})}}if(!b.hasOwnProperty("options"))throw new Error("options are required!");if(b.options.heading="undefined"==typeof b.options.heading?"EduCrud":b.options.heading,b.options.metaData.panelType="undefined"==typeof b.options.metaData.panelType?"default":b.options.metaData.panelType,b.options.showOverlayLoading="undefined"==typeof b.options.showOverlayLoading?!1:b.options.showOverlayLoading,b.options.showOvelayFormDelete="undefined"==typeof b.options.showOvelayFormDelete?!1:b.options.showOvelayFormDelete,b.options.showRefreshButton="undefined"==typeof b.options.showRefreshButton?!0:b.options.showRefreshButton,b.options.showAddButtonTopLeft="undefined"==typeof b.options.showAddButtonTopLeft?!0:b.options.showAddButtonTopLeft,b.options.showPagination="undefined"==typeof b.options.showPagination?!0:b.options.showPagination,b.options.showItemsPerPage="undefined"==typeof b.options.showItemsPerPage?!0:b.options.showItemsPerPage,b.options.showSearch="undefined"==typeof b.options.showSearch?!0:b.options.showSearch,b.options.showAvancedSearch="undefined"==typeof b.options.showAvancedSearch?!1:b.options.showAvancedSearch,b.options.showMetaData="undefined"==typeof b.options.showMetaData?!0:b.options.showMetaData,b.options.paginationWidth="undefined"==typeof b.options.paginationWidth?3:b.options.paginationWidth,b.options.showButtonsCrudEditPre="undefined"==typeof b.options.showButtonsCrudEditPre?!0:b.options.showButtonsCrudEditPre,b.options.showButtonsCrudDeletePre="undefined"==typeof b.options.showButtonsCrudDeletePre?!0:b.options.showButtonsCrudDeletePre,b.options.showButtonsCrudEditPost="undefined"==typeof b.options.showButtonsCrudEditPost?!1:b.options.showButtonsCrudEditPost,b.options.showButtonsCrudDeletePost="undefined"==typeof b.options.showButtonsCrudDeletePost?!1:b.options.showButtonsCrudDeletePost,b.options.showRowNumber="undefined"==typeof b.options.showRowNumber?!0:b.options.showRowNumber,b.options.showSelectRow="undefined"==typeof b.options.showSelectRow?!1:b.options.showSelectRow,"undefined"!=typeof b.options.metaData?b.options.metaData.limit="undefined"==typeof b.options.metaData.limit?5:b.options.metaData.limit:b.options.metaData={limit:5},"undefined"!=typeof b.options.panelType&&(b.options.metaData.panelType=b.options.panelType),"undefined"!=typeof b.options.limit&&(b.options.metaData.limit=b.options.limit),"undefined"!=typeof b.options.orderBy&&(b.options.metaData.orderBy=b.options.orderBy),"undefined"!=typeof b.options.order&&(b.options.metaData.order=b.options.order),b.options.hasOwnProperty("snippets")&&b.options.snippets.hasOwnProperty("buttonNew")&&(b.options.snippets.buttonAdd=b.options.snippets.buttonNew),b.options.crudControl={},b.showForm=!1,b.options.buttonsGridUserPre=[],b.options.buttonsGridUserPost=[],b.options.formData={},b.formFieldsError=!1,b.formOptionsError=!1,b.options.showButtonsGridUserPre=b.options.showButtonsCrudPre||b.options.showButtonsCrudEditPre||b.options.showButtonsCrudDeletePre||b.options.showButtonsUserPre,b.options.showButtonsGridUserPost=b.options.showButtonsCrudPost||b.options.showButtonsCrudEditPost||b.options.showButtonsCrudDeletePost||b.options.showButtonsUserPost,"new"==b.options.state&&g(),b.internalControl=b.options.crudControl||{},b.internalControl.stateNew=function(){g()},b.internalControl.refresh=function(a){b.options.gridControl.refresh(a)},b.internalControl.updateFields=function(){b.options.gridControl.updateFields(),b.updateFields()},b.internalControl.showOverlayLoading=function(a){b.options.gridControl.showOverlayLoading(a)},b.internalControl.clearGrid=function(a){b.options.gridControl.clearGrid()},b.internalControl.clearCrud=function(a){b.options.gridControl.clearGrid(),b.options.formControl.clearForm()},b.internalControl.showOverlayFormDelete=function(a){b.options.showOverlayCrudFormDelete=a},b.internalControl.showOverlayFormUser=function(a){b.options.gridControl.showOverlayFormUser(a)},b.internalControl.clearForm=function(){b.options.formControl.clearForm()},b.internalControl.selectTab=function(a){b.options.formControl.selectTab(a)},b.internalControl.showButtonsUserPre=function(a){b.options.gridControl.showButtonsUserPre(a)},b.internalControl.showButtonsUserPost=function(a){b.options.gridControl.showButtonsUserPost(a)},b.internalControl.showButtonsCrudPre=function(a){console.log("showButtonsCrudPre"+a),b.options.showButtonsCrudEditPre=a,b.options.showButtonsCrudDeletePre=a},b.internalControl.showButtonsCrudPost=function(a){b.options.showButtonsCrudEditPost=a,b.options.showButtonsCrudDeletePost=a},b.internalControl.showButtonsCrudEditPre=function(a){console.log("showButtonsCrudPre"+a),b.options.showButtonsCrudEditPre=a},b.internalControl.showButtonsCrudEditPost=function(a){b.options.showButtonsCrudEditPost=a},b.internalControl.showButtonsCrudDeletePre=function(a){console.log("showButtonsCrudPre"+a),b.options.showButtonsCrudDeletePre=a},b.internalControl.showButtonsCrudDeletePost=function(a){b.options.showButtonsCrudDeletePost=a},b.internalControl.clearSelection=function(){b.options.gridControl.clearSelection()},b.options.hasOwnProperty("showButtonsCrudPre")&&(b.options.showButtonsCrudEditPre=b.options.showButtonsCrudPre,b.options.showButtonsCrudDeletePre=b.options.showButtonsCrudPre),b.options.hasOwnProperty("showButtonsCrudPost")&&(b.options.showButtonsCrudEditPost=b.options.showButtonsCrudPost,b.options.showButtonsCrudDeletePost=b.options.showButtonsCrudPost),b.options.hasOwnProperty("showAddButtonTopLeft")&&(b.options.showExtraButtonTopLeft=b.options.showAddButtonTopLeft),b.options.hasOwnProperty("showAddButtonTopRight")&&(b.options.showExtraButtonTopRight=b.options.showAddButtonTopRight),b.options.hasOwnProperty("snippets")&&b.options.snippets.hasOwnProperty("buttonAdd")&&(b.options.snippets.extraButtonTop=b.options.snippets.buttonAdd),b.options.hasOwnProperty("listListeners")||(b.options.listListeners={}),b.$watch("mode",function(a,c){a!==c&&b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("onChangeMode")&&"function"==typeof b.options.crudListeners.onChangeMode&&b.options.crudListeners.onChangeMode(a,c)}),b.options.listListeners.onExtraButtonClick=function(){g()},b.updateFields=function(){"undefined"!=typeof b.options.crudUri&&""!==b.options.crudUri&&(b.api=e(b.options.crudUri,"undefined"!=typeof b.options.actions?b.options.actions:""))},b.options.showButtonsUserPre&&b.options.hasOwnProperty("buttonsUserPre"))for(var h=0;h<b.options.buttonsUserPre.length;h++)b.options.buttonsGridUserPre.push(b.options.buttonsUserPre[h]);if(b.options.showButtonsUserPost&&b.options.hasOwnProperty("buttonsUserPost"))for(var h=0;h<b.options.buttonsUserPost.length;h++)b.options.buttonsGridUserPost.push(b.options.buttonsUserPost[h]);if(b.options.showButtonsCrudEditPre){var i={label:"Editar","class":"",glyphicon:"edit",button:!1,onclick:function(a){b.edit(a)}};b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("hiddenButtonEditPre")&&"function"==typeof b.options.crudListeners.hiddenButtonEditPre&&(i.hidden=b.options.crudListeners.hiddenButtonEditPre),b.options.buttonsGridUserPre.push(i)}if(b.options.showButtonsCrudDeletePre){var i={label:"Eliminar","class":"",glyphicon:"trash",button:!1,onclick:function(a){b.selectedRowForDelete=a,b.keyRowForDelete=a[b.options.fieldKey],b.options.showOverlayCrudFormDelete=!0}};b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("hiddenButtonDeletePre")&&"function"==typeof b.options.crudListeners.hiddenButtonDeletePre&&(i.hidden=b.options.crudListeners.hiddenButtonDeletePre),b.options.buttonsGridUserPre.push(i)}if(b.options.showButtonsCrudEditPost){var i={label:"Editar","class":"",glyphicon:"edit",button:!1,onclick:function(a){b.edit(a)}};b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("hiddenButtonEditPost")&&"function"==typeof b.options.crudListeners.hiddenButtonEditPost&&(i.hidden=b.options.crudListeners.hiddenButtonEditPost),b.options.buttonsGridUserPost.push(i)}if(b.options.showButtonsCrudDeletePost){var i={label:"Eliminar","class":"",glyphicon:"trash",button:!1,onclick:function(a){b.selectedRowForDelete=a,b.keyRowForDelete=a[b.options.fieldKey],b.options.showOverlayCrudFormDelete=!0}};b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("hiddenButtonDeletePost")&&"function"==typeof b.options.crudListeners.hiddenButtonDeletePost&&(i.hidden=b.options.crudListeners.hiddenButtonDeletePost),b.options.buttonsGridUserPost.push(i)}b.options.buttonsUserPre=b.options.buttonsGridUserPre,b.options.buttonsUserPost=b.options.buttonsGridUserPost,b.options.showOverlayLoading=!1,b.startLoading=function(){b.options.gridControl.showOverlayLoading(!0)},b.finishLoading=function(){b.options.gridControl.showOverlayLoading(!1)},b.api=null,"undefined"!=typeof b.options.crudUri&&""!==b.options.crudUri&&(b.api=e(b.options.crudUri,"undefined"!=typeof b.options.actions?b.options.actions:"")),b.options.formListeners={onsave:function(a){b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("onBeforeSave")&&"function"==typeof b.options.crudListeners.onBeforeSave&&(a=b.options.crudListeners.onBeforeSave(a)),b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("addValueToForm")&&"function"==typeof b.options.crudListeners.addValueToForm&&(a=b.options.crudListeners.addValueToForm(a)),b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("onBeforeSaveValidation")&&"function"==typeof b.options.crudListeners.onBeforeSaveValidation?b.options.crudListeners.onBeforeSaveValidation(a)&&b.save(a):b.save(a)},oncancel:function(){b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("onBeforeCancel")&&"function"==typeof b.options.crudListeners.onBeforeCancel&&b.options.crudListeners.onBeforeCancel(),b.cancel()}},b.cancel=function(){c.log("click cancel"),b.state="list",b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("onAfterCancel")&&"function"==typeof b.options.crudListeners.onAfterCancel&&b.options.crudListeners.onAfterCancel(),b.showForm=!1},b.edit=function(a){console.log("Edit row:",a),b.state="edit",b.showForm=!0;for(var c=0;c<b.options.formFields.tabs.length;c++)for(var d=0;d<b.options.formFields.tabs[c].fieldSets.length;d++)for(var e=0;e<b.options.formFields.tabs[c].fieldSets[d].fields.length;e++)b.options.formFields.tabs[c].fieldSets[d].fields[e].hasOwnProperty("disabledEdit")&&""!=b.options.formFields.tabs[c].fieldSets[d].fields[e].disabled&&(b.options.formFields.tabs[c].fieldSets[d].fields[e].disabledTmp=b.options.formFields.tabs[c].fieldSets[d].fields[e].disabled,b.options.formFields.tabs[c].fieldSets[d].fields[e].disabled=b.options.formFields.tabs[c].fieldSets[d].fields[e].disabledEdit),b.options.formFields.tabs[c].fieldSets[d].fields[e].hasOwnProperty("readonlyEdit")&&""!=b.options.formFields.tabs[c].fieldSets[d].fields[e].readonly&&(b.options.formFields.tabs[c].fieldSets[d].fields[e].readonlyTmp=b.options.formFields.tabs[c].fieldSets[d].fields[e].readonly,b.options.formFields.tabs[c].fieldSets[d].fields[e].readonly=b.options.formFields.tabs[c].fieldSets[d].fields[e].readonlyEdit);b.options.formControl&&b.options.formControl.showOverlayLoading(!0);var g=f(a);b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("onBeforeButtonEditCrud")&&"function"==typeof b.options.crudListeners.onBeforeButtonEditCrud&&b.options.crudListeners.onBeforeButtonEditCrud(g.id,a),b.api.get(g,function(a){b.options.formData=a,b.options.formFields.tabs[0].active=!0;for(var c,d=0;c=b.options.formFields.tabs[d];d++)for(var e,f=0;e=c.fieldSets[f];f++)for(var h,i=0;h=e.fields[i];i++)"grid"==h.type&&(h.valueFk=g.id,h.fieldControl.refresh(g.id));b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("onAfterButtonEditCrud")&&"function"==typeof b.options.crudListeners.onAfterButtonEditCrud&&b.options.crudListeners.onAfterButtonEditCrud(!0,a),b.options.formControl.showOverlayLoading(!1)},function(a){b.options.formControl.showOverlayLoading(!1),b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("onAfterButtonEditCrud")&&"function"==typeof b.options.crudListeners.onAfterButtonEditCrud&&b.options.crudListeners.onAfterButtonEditCrud(!1),b.showForm=!1,b.options.gridControl.showOverlayFormSuccessError("0",a.data,2e4)})},b.save=function(a){if("edit"==b.state){var c=f(a);b.api.update(c,a,function(a){b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("onAfterSave")&&"function"==typeof b.options.crudListeners.onAfterSave&&b.options.crudListeners.onAfterSave(a),b.options.gridControl.refresh()},function(a){b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("onAfterSave")&&"function"==typeof b.options.crudListeners.onAfterSave&&b.options.crudListeners.onAfterSave(a),b.options.gridControl.showOverlayFormSuccessError("0",a.data,2e4)})}else"new"==b.state&&b.api.insert(a,function(a){b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("onAfterSave")&&"function"==typeof b.options.crudListeners.onAfterSave&&b.options.crudListeners.onAfterSave(a),b.options.gridControl.refresh()},function(a){b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("onAfterSave")&&"function"==typeof b.options.crudListeners.onAfterSave&&b.options.crudListeners.onAfterSave(a),b.options.gridControl.showOverlayFormSuccessError("0",a.data,2e4)});b.state="list",b.showForm=!1},b.remove=function(a){var c=f(a);b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("onBeforeButtonDeleteCrud")&&"function"==typeof b.options.crudListeners.onBeforeButtonDeleteCrud&&b.options.crudListeners.onBeforeButtonDeleteCrud(c.id,a),b.api.remove(c,function(a){b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("onAfterButtonDeleteCrud")&&"function"==typeof b.options.crudListeners.onAfterButtonDeleteCrud&&b.options.crudListeners.onAfterButtonDeleteCrud(!0),b.options.gridControl.refresh()},function(a){b.options.hasOwnProperty("crudListeners")&&b.options.crudListeners.hasOwnProperty("onAfterButtonDeleteCrud")&&"function"==typeof b.options.crudListeners.onAfterButtonDeleteCrud&&b.options.crudListeners.onAfterButtonDeleteCrud(!1),b.options.gridControl.showOverlayFormSuccessError("0",a.data,2e4)})},b.formDeleteContinue=function(){b.remove(b.selectedRowForDelete),b.options.showOverlayCrudFormDelete=!1},b.formDeleteCancel=function(){b.options.showOverlayCrudFormDelete=!1}}]}}),angular.module("edu-crud.tpl").run(["$templateCache",function(a){"use strict";a.put("directives/edu-crud.tpl.html","<div><div ng-if=!options><h4>Options are required</h4></div><div class=box ng-if=options><div ng-hide=showForm><div class=panel-body><div edu-grid options=options></div></div></div><div ng-if=showForm><div class=panel-body><div><div edu-form result=options.formData options=options></div></div></div></div><div name=overlay class=overlay-edu-crud ng-show=options.showOverlayCrudFormDelete><div class=centrado-edu-crud><div class=\"panel panel-info\"><div class=panel-heading><div class=row><div class=col-md-12><h4>{{options.snippets.formDeleteTitle || 'Por favor confirme'}}</h4></div></div></div><div class=panel-body><h4>{{options.snippets.formDeleteMessage || '¿Está seguro que quiere ELIMINAR el registro'}} {{keyRowForDelete}} ?</h4></div><div class=panel-footer><div class=row><div class=\"col-md-offset-6 col-md-6\"><button ng-click=formDeleteContinue() class=\"btn btn-sm btn-primary\">{{options.snippets.formDeleteButtonContinue || 'Continuar'}}</button> <button ng-click=formDeleteCancel() class=\"btn btn-sm\">{{options.snippets.formDeleteButtonCancel || 'Cancelar'}}</button></div></div></div></div></div></div></div></div>")}]);
//# sourceMappingURL=edu-crud.min.map